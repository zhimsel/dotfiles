#!/usr/bin/env sh
usage_and_exit () {
cat <<EOF
git sed <grep_args> <sed_args>

Run a given sed expression (<sed_args>) against any git files that match a
git-grep pattern (<grep_args>)

The first argument (separated by whitespace, so group with quotes if needed!)
will be used as the arg for git-grep.

The second argument (also separated by whitespace) will be used as the args for
sed.

Note: this requires the GNU sed! If you're on a system without GNU sed, you
should install it (at gsed in your \$PATH) or rewrite this to work.
EOF
exit 1
}

# Use `gsed` if we're on a Mac
if [ "$(uname)" = "Darwin" ]; then
  if [ -x "$(command -v gsed)" ]; then
    sed="gsed"
  else
    echo "GNU sed cannot be found! Make sure it's somewhere git can find it."
    exit 1
  fi
else
  sed="sed"
fi

[ "$1" = "-h" ] && usage_and_exit
[ -z "$2" ] && usage_and_exit

git grep -z --no-color --name-only $1 |
  xargs -0 $sed --separate -i $2
